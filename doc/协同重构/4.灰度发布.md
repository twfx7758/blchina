# 老协同技术改造灰度发布方案

## 一、上线灰度后的订单处理入口

- 正式单子协同处理入口
  - 企业微信->百得利集团->i Better->我的任务
- 分流到新协同的处理入口
  - 企业微信->百得利集团->I\_售后 1.1->我的任务

## 二、上线需准备数据

- 效能中心
  - 配置老协同的角色
  - 同步老协同的各门店工作人员数据
- 应用层
  - 汇总线上正在运营的门店
  - 配置每个门店的任务模板及模板组
- workflow 服务中心
  - 配置好每个门店的工作流
- 运营团队
  - 做正式订单时，需运营同事帮忙与门店人员沟通，提供客户的登录手机号。

## 三、可能发生的影响

- 数据库添加字段，导致 prd 环境发生异常，需要上线后虚拟租户验证
- 新的协同流程有问题，导致用户订单完成不了，此问题需要先虚拟租户验证新协同功能，然后再找线上用户验证与 sap 对接情况

## 四、涉及项目

- 前端项目

  - 魔比商城（moby-wechat）

    - 合并分支

      - prd1.0

        - 正式 prd 添加分流逻辑，分流逻辑如下：
          - 前期按用户手机号做分流，确定好下单用户，手机号添加进配置表，此手机号下的订单自动分配到新的协同流程上。

      - prd1.1

  - PC 门店端及总部端（moby-platfrom-dashboard、moby-store-dashboard）
    - 合并分支
      - prd1.1

- 后端项目
  - 应用层（moby-application-api）
    - 合并分支
      - prd1.0
        - 灰度的逻辑接口。
      - prd1.1
        - 新协同的业务逻辑入口
  - 交易中心（car-deepexi-trade-center）
    - 合并分支
      - prd1.1
  - workflow 服务中心（moby-workflow-service-center）
    - 合并分支
      - prd1.1
  - 工单中心（moby-workorder-center）
    - 合并分支
      - prd1.1
  - 效能中心（moby-efficiency-center）
    - 合并分支
      - prd1.1
  - 车辆中心（car-deepexi-car-center）
    - 合并分支
      - prd1.1
