# 新协同改造详细方案汇总

一、**主要实现功能点**

- 工作流维护管理各角色之间工作的协作
  - 串联了工作人员之间的关联关系
- 协同管理角色每个工作的任务组合
  - 串联工作人员自己工作的顺序组合
  - 任务组内的任务可以灵活组合
  - 每个任务有对应的模板配置
  - 任务模板包含：
    - 任务 title
    - 任务对应处理的 handler
    - 是否要触发其它角色的工作

二、**新车下单流程**

1、手动预约商务顾问

![avatar](./out/plantuml/1.手动预约商务顾问/手动预约商务顾问.png)

2、自动预约商务顾问

![avatar](./out/plantuml/2.自动预约商务顾问/自动预约商务顾问.png)

三、**类图设计**

![avatar](./out/plantuml/4.协同类图/协同类图.png)

四、**协同流程**

![avatar](./out/plantuml/3.新车协同流程/3.新车协同流程.png)

五、**数据库设计**

![avatar](./out/plantuml/5.协同数据库设计/数据库ER图.png)

六、**模板设计规范**

- 任务组模板

```
{
    "content": "客户金融分期已办理成功，已经获取批贷函",
    "templateGroupParser": "com.deepexi.application.workflow.template.impl.LoanCompletionGroupParser",
    "complateStatus": "",
    "inComplateStatus": ""
}
```

- 任务模板

```
{
    "content": "订单调整",
    "templateParser": "com.deepexi.application.workflow.template.impl.SubscribeOrderAdjustmenParser",
    "button": {
        "setting": {
            "type": "settings",
            "repeat": "0",
            "url": "/staff/task-restructure/payment-setting"
        },
        "action": {
            "handler": "com.deepexi.application.workflow.task.impl.SubscribeStoreHandler"
        }
    },
    "childTask": [
        6,
        7
    ],
    "activitiNode": "收银"
}
```

七、**已知缺陷**

- 跟订单状态有关联的，比如：
  - 如果订单未订转定，sap 就没法结算，这是业务写死的
  - 如果客户未签合同，商务顾问就没法结束考虑期，这也是业务写死的

八、**灰度发布方案**

