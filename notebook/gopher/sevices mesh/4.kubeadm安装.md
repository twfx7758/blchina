# k8s安装

## master初始化

- kubeadm init --kubernetes-version=v1.17.0 --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.2.199 --ignore-preflight-errors=Swap
  
## 加入k8s集群  

- kubeadm join 192.168.0.188:6443 --token cudjth.w0k9sbkcbat6jz6p --discovery-token-ca-cert-hash sha256:13502214695ef263ceaae07b98feedf5c332c089635597e56867c419822e89ed
- kubeadm init时要去掉代理，不然创建kubelet的时候报错
- kubectl也要去掉代理，不然访问不了api

## 开启代理

- pip指定源 pip install pymysql -i url
  - [pip安装包出现Retrying](https://blog.csdn.net/nahanai/article/details/96435128)
  - [Centos7配置shadowsocks（ss）客户端——拉取外地镜像2](https://blog.csdn.net/halobios_/article/details/100741713)
- systemctl start shadowsocks
- systemctl stop shadowsocks
- systemctl start privoxy
- systemctl stop privoxy
- vi /etc/profile
- source /etc/profile
- shadowsocks依赖的库（libsodium）
  - https://blog.csdn.net/lengconglin/article/details/77655845

## 安装flannel时的问题

- 安装：kubectl apply -f  kube-flannel.yml
- 错误：pod cidr not assigned
- 解决方案：
  - 1、kubeadm reset
  - 2、然后重装flannel
  - 3、network要与--pod-network-cidr保持一致

## 主节点加入node集群

- 1、kubectl describe node node1 | grep Taint
- 2、kubectl taint nodes node1 node-role.kubernetes.io/master-

## 访问dashboard

- 开始代理：kubectl proxy --address=192.168.0.188 --disable-filter=true
- 访问地址：http://192.168.0.188:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login

## k8s常用命令

- kubectl get pod,svc -o wide -n kube-system

## Rancher管理k8s

- admin wenbin83528