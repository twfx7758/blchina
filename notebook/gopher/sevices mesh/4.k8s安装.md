# k8s 安装

## master 初始化

- kubeadm init --apiserver-advertise-address=192.168.2.188 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.17.0 --service-cidr=10.1.0.0/16 --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors=Swap

## 加入 k8s 集群

- kubeadm join 192.168.2.188:6443 --token p51zg5.anzyjjx2rchu9o00 --discovery-token-ca-cert-hash sha256:e96f702537c41c85cc9a478b7c035a79df4354fbdf771e3e3c25c60fbcde5431

## 开启代理

- 文章：https://www.jianshu.com/p/824912d9afda
- systemctl start shadowsocks
- systemctl stop shadowsocks
- systemctl start privoxy
- systemctl stop privoxy
- vi /etc/profile
- source /etc/profile

## 安装 flannel 时的问题

- 安装：kubectl apply -f kube-flannel.yml
- 错误：pod cidr not assigned
- 解决方案：
  - 1、kubeadm reset
  - 2、然后重装 flannel
  - 3、network 要与--pod-network-cidr 保持一致

## 主节点加入 node 集群

- 1、kubectl describe node node1 | grep Taint
- 2、kubectl taint nodes node1 node-role.kubernetes.io/master-

## 访问 dashboard

- 开始代理：kubectl proxy --address=192.168.0.188 --disable-filter=true
- 访问地址：http://192.168.0.188:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login

## k8s 常用命令

- kubectl get pod,svc -o wide -n kube-system

## Rancher 管理 k8s

- admin wenbin83528

## 参考资料

- [kubeadm 部署 K8S 集群](https://www.cnblogs.com/ElegantSmile/p/12088520.html)
- [kubeadm 快速部署 Kubernetes 单节点](https://www.cnblogs.com/Tempted/p/10671292.html)
